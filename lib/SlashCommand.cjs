"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const A=require("./index-CSvnpArE.cjs"),q=require("./dom-dataset-Cuy-pIfj.cjs"),$=require("./index-Cyh1yoFk.cjs"),j=require("tippy.js"),f=require("react/jsx-runtime"),g=require("react"),L=require("./RichTextEditor-Bf4imLfI.cjs"),h=require("./index-C2frEgG3.cjs");function P(n,m){var v,N;const[t,i]=g.useState(0),[e,o]=g.useState(0),r=g.useRef(null),{t:s}=h.useLocale(),u=g.useRef([]);g.useImperativeHandle(m,()=>({onKeyDown:x})),g.useEffect(()=>{if(!r.current)return;const l=e*1e3+t,c=u.current[l];c&&c.scrollIntoView({behavior:"smooth",block:"nearest"})},[t,e]);function x({event:l}){return l.key==="ArrowUp"?(b(),!0):l.key==="ArrowDown"?(C(),!0):l.key==="Enter"?(k(),!0):!1}function b(){var d;if(n.items.length===0)return!1;let l=t-1,c=e;l<0&&(c=e-1,l=((d=n.items[c])==null?void 0:d.commands.length)-1||0),c<0&&(c=n.items.length-1,l=n.items[c].commands.length-1),i(l),o(c)}function C(){if(n.items.length===0)return!1;const l=n.items[e].commands;let c=t+1,d=e;l.length-1<c&&(c=0,d=e+1),n.items.length-1<d&&(d=0),i(c),o(d)}function k(){if(n.items.length===0||e===-1||t===-1)return!1;R(e,t)}function R(l,c){const d=n.items[l].commands[c];n.command(d)}function E(l,c){R(l,c)}function I(l,c,d){u.current[l*1e3+c]=d}return f.jsx("div",{className:"richtext-mb-8 richtext-max-h-[min(80vh,24rem)] richtext-flex-wrap richtext-overflow-auto richtext-rounded-lg !richtext-border !richtext-border-neutral-200 !richtext-bg-white richtext-p-1 !richtext-text-black richtext-shadow-sm dark:!richtext-border-neutral-800 dark:!richtext-bg-black",ref:r,children:(v=n==null?void 0:n.items)!=null&&v.length?f.jsx("div",{className:"richtext-grid richtext-min-w-48 richtext-grid-cols-1 richtext-gap-0.5",children:(N=n==null?void 0:n.items)==null?void 0:N.map((l,c)=>f.jsxs(g.Fragment,{children:[f.jsx("div",{className:"richtext-col-[1/-1] richtext-mx-2 richtext-mt-2 richtext-select-none richtext-text-[0.65rem] richtext-font-semibold richtext-uppercase richtext-tracking-wider !richtext-text-neutral-500 first:richtext-mt-0.5",children:l.title}),l.commands.map((d,y)=>f.jsxs("button",{onClick:()=>E(c,y),ref:S=>I(c,y,S),className:L.cn("richtext-flex richtext-items-center richtext-gap-3 richtext-px-2 richtext-py-1.5 richtext-text-sm !richtext-text-neutral-800 dark:!richtext-text-neutral-200 richtext-text-left richtext-w-full richtext-rounded-sm richtext-outline-none richtext-transition-colors !richtext-bg-transparent hover:!richtext-bg-accent ",{"slash-command-active":e===c&&t===y}),children:[d.iconUrl&&f.jsx("img",{alt:"",className:"richtext-size-6",src:d.iconUrl}),d.iconName&&f.jsx(L.IconComponent,{className:"!richtext-mr-1 !richtext-text-lg",name:d.iconName}),d.label]},`command-${y}`))]},`slash-${l.title}`))}):f.jsx("div",{className:"richtext-p-3",children:f.jsx("span",{className:"richtext-text-xs richtext-text-gray-800 dark:richtext-text-gray-100",children:s("editor.slash.empty")})})})}const M=g.forwardRef(P);function O(n,m){const t=[{name:"format",title:h.localeActions.t("editor.slash.format"),commands:[]},{name:"insert",title:h.localeActions.t("editor.slash.insert"),commands:[]}];return n.forEach(i=>{i.name.toLowerCase()==="heading"&&i.options.levels.forEach(e=>{t[0].commands.push({name:`heading${e}`,label:h.localeActions.t(`editor.heading.h${e}.tooltip`),aliases:[`h${e}`,"bt",`bt${e}`],iconName:`Heading${e}`,action:({editor:o,range:r})=>{o.chain().focus().deleteRange(r).setHeading({level:e}).run()}})}),i.name.toLowerCase()==="bulletlist"&&t[0].commands.push({name:"bulletList",label:h.localeActions.t("editor.bulletlist.tooltip"),aliases:["ul","yxlb"],iconName:"List",action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).toggleBulletList().run()}}),i.name.toLowerCase()==="orderedlist"&&t[0].commands.push({name:"numberedList",label:h.localeActions.t("editor.orderedlist.tooltip"),aliases:["ol","yxlb"],iconName:"ListOrdered",action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).toggleOrderedList().run()}}),i.name.toLowerCase()==="tasklist"&&t[0].commands.push({name:"taskList",label:h.localeActions.t("editor.tasklist.tooltip"),iconName:"ListTodo",description:"Task list with todo items",aliases:["todo"],action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).toggleTaskList().run()}}),i.name.toLowerCase()==="blockquote"&&t[0].commands.push({name:"blockquote",label:h.localeActions.t("editor.blockquote.tooltip"),description:"插入引入格式",aliases:["yr"],iconName:"TextQuote",action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).setBlockquote().run()}}),i.name.toLowerCase()==="codeblock"&&t[0].commands.push({name:"codeBlock",label:h.localeActions.t("editor.codeblock.tooltip"),iconName:"Code2",description:"Code block with syntax highlighting",shouldBeHidden:e=>e.isActive("columns"),action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).setCodeBlock().run()}}),i.name.toLowerCase()===L.Image$1.name&&t[1].commands.push({name:"image",label:h.localeActions.t("editor.image.tooltip"),iconName:"ImageUp",description:"Insert a image",aliases:["image","tp","tupian"],shouldBeHidden:e=>e.isActive("columns"),action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).run(),L.actionDialogImage.setOpen(e.id,!0)}}),i.name.toLowerCase()==="table"&&t[1].commands.push({name:"table",label:h.localeActions.t("editor.table.tooltip"),iconName:"Table",description:"Insert a table",aliases:["table","bg","biaoge","biao"],shouldBeHidden:e=>e.isActive("columns"),action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).insertTable({rows:3,cols:3,withHeaderRow:!1}).run()}}),i.name.toLowerCase()==="horizontalrule"&&t[1].commands.push({name:"horizontalRule",label:h.localeActions.t("editor.horizontalrule.tooltip"),iconName:"Minus",description:"Insert a horizontal divider",aliases:["hr","fgx","fg"],action:({editor:e,range:o})=>{e.chain().focus().deleteRange(o).setHorizontalRule().run()}}),i.name.toLowerCase()==="columns"&&t[1].commands.push({name:"columns",label:h.localeActions.t("editor.columns.tooltip"),iconName:"Columns2",description:"Add two column content",action:({editor:e})=>{e.chain().focus().insertColumns({cols:2}).run()}}),m==null||m(i,t)}),t}const w="slashCommand";let a;const H=A.Extension.create({name:w,priority:200,onCreate(){a=j("body",{interactive:!0,trigger:"manual",placement:"bottom-start",theme:"slash-command",maxWidth:"16rem",offset:[16,8],popperOptions:{strategy:"fixed",modifiers:[{name:"flip",enabled:!1}]}})},addProseMirrorPlugins(){return[$.Suggestion({editor:this.editor,char:"/",allowSpaces:!0,startOfLine:!0,pluginKey:new A.PluginKey(w),allow:({state:n,range:m})=>{var x,b,C;const t=n.doc.resolve(m.from),i=t.depth===1,e=t.parent.type.name==="paragraph",o=((x=t.parent.textContent)==null?void 0:x.charAt(0))==="/",r=this.editor.isActive("column"),s=(C=t.parent.textContent)==null?void 0:C.slice(Math.max(0,(b=t.parent.textContent)==null?void 0:b.indexOf("/"))),u=!(s!=null&&s.endsWith("  "));return(i&&e&&o||r&&e&&o)&&u},command:({editor:n,range:m,props:t})=>{const{view:i}=n;t.action({editor:n,range:m}),i.focus()},items:({query:n,editor:m})=>O(m.extensionManager.extensions,this.options.renderGroupItem).map(r=>({...r,commands:r.commands.filter(s=>{const u=s.label.toLowerCase().trim(),x=n.toLowerCase().trim();if(s.aliases){const b=s.aliases.map(R=>R.toLowerCase().trim()),C=u.match(x),k=b.some(R=>R.match(x));return C||k}return u.match(x)}).filter(s=>s.shouldBeHidden?!s.shouldBeHidden(this.editor):!0)})).filter(r=>r.commands.length>0).map(r=>({...r,commands:r.commands.map(s=>({...s,isEnabled:!0}))})),render:()=>{let n,m=null;return{onStart:t=>{var o;n=new q.ReactRenderer(M,{props:t,editor:t.editor});const{view:i}=t.editor,e=()=>{if(!t.clientRect)return t.editor.storage[w].rect;const r=t.clientRect();if(!r)return t.editor.storage[w].rect;let s=r.y;if(r.top+n.element.offsetHeight+40>window.innerHeight){const u=r.top+n.element.offsetHeight-window.innerHeight+40;s=r.y-u}return new DOMRect(r.x,s,r.width,r.height)};m=()=>{a==null||a[0].setProps({getReferenceClientRect:e})},(o=i.dom.parentElement)==null||o.addEventListener("scroll",m),a==null||a[0].setProps({getReferenceClientRect:e,appendTo:()=>document.body,content:n.element}),a==null||a[0].show()},onUpdate(t){var r;n.updateProps(t);const{view:i}=t.editor,e=()=>{if(!t.clientRect)return t.editor.storage[w].rect;const s=t.clientRect();return s?new DOMRect(s.x,s.y,s.width,s.height):t.editor.storage[w].rect},o=()=>{a==null||a[0].setProps({getReferenceClientRect:e})};(r=i.dom.parentElement)==null||r.addEventListener("scroll",o),t.editor.storage[w].rect=t.clientRect?e():{width:0,height:0,left:0,top:0,right:0,bottom:0},a==null||a[0].setProps({getReferenceClientRect:e})},onKeyDown(t){var i;return t.event.key==="Escape"?(a==null||a[0].hide(),!0):(a!=null&&a[0].state.isShown||a==null||a[0].show(),(i=n.ref)==null?void 0:i.onKeyDown(t))},onExit(t){var i;if(a==null||a[0].hide(),m){const{view:e}=t.editor;(i=e.dom.parentElement)==null||i.removeEventListener("scroll",m)}n.destroy()}}}})]},addStorage(){return{rect:{width:0,height:0,left:0,top:0,right:0,bottom:0}}}});exports.SlashCommand=H;exports.default=H;
