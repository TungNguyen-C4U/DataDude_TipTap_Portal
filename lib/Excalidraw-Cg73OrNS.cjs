"use strict";var W=Object.create;var y=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var B=(e,t,s,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Z(t))!z.call(e,i)&&i!==s&&y(e,i,{get:()=>t[i],enumerable:!(l=H(t,i))||l.enumerable});return e};var M=(e,t,s)=>(s=e!=null?W(q(e)):{},B(t||!e||!e.__esModule?y(s,"default",{value:e,enumerable:!0}):s,e));const _=require("./index-CSvnpArE.cjs"),p=require("./dom-dataset-Cuy-pIfj.cjs"),n=require("react/jsx-runtime"),a=require("react"),d=require("./RichTextEditor-RTtjPxJW.cjs"),P=require("./index-Dz3YxLE7.cjs"),V=require("re-resizable");let L;function I(){try{return L||(L=P.mitt()),L}catch{throw new Error("Error EventEmitter")}}const D="OPEN_EXCALIDRAW_SETTING_MODAL";function $(e,t){I().on(e,t)}function U(e,t){I().off(e,t)}function X(e){I().emit(D,e)}const F=({editor:e})=>{const[t,s]=a.useState(null),[l,i]=a.useState({}),[h,f]=a.useState({elements:[],appState:{isLoading:!1},files:null}),[m,o]=a.useState(!1),[w,x]=a.useState(!0),[E,g]=a.useState(null),S=a.useCallback(c=>{c&&import("@excalidraw/excalidraw").then(r=>{s(r.Excalidraw)}).catch(g).finally(()=>x(!1))},[x]),j=a.useCallback(c=>{setTimeout(()=>{c.refresh()})},[]),T=a.useCallback((c,r,u)=>{i({elements:c,appState:{isLoading:!1},files:u})},[]),v=a.useCallback(()=>{if(!t){o(!1);return}e.chain().focus().setExcalidraw({data:l}).run(),o(!1)},[t,e,l,o]);return a.useEffect(()=>{const c=r=>{(r==null?void 0:r.editor)===e&&(o(!0),r&&f(r.data))};return $(D,c),()=>{U(D,c)}},[e,o]),a.useEffect(()=>{!w&&t&&m&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},400)},[w,t,m]),n.jsxs(d.Dialog,{onOpenChange:o,open:m,children:[n.jsx(d.DialogTrigger,{asChild:!0,children:n.jsx(d.ActionButton,{action:()=>o(!0),icon:"Excalidraw",tooltip:"Excalidraw"})}),n.jsxs(d.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[n.jsx(d.DialogTitle,{children:"Excalidraw"}),n.jsxs("div",{style:{height:"100%",borderWidth:1},children:[w&&n.jsx("p",{children:"Loading..."}),E&&n.jsx("p",{children:E&&E.message||"Error"}),n.jsx("div",{ref:S,style:{width:"100%",height:600},children:!w&&!E&&t?n.jsx(t,{initialData:h,langCode:"en",onChange:T,ref:j}):null})]}),n.jsx(d.DialogFooter,{children:n.jsx(d.Button,{onClick:v,type:"button",children:"Save changes"})})]})]})},G="_wrap_15k3c_1",Y="_renderWrap_15k3c_7",J="_handlerWrap_15k3c_30",A={wrap:G,renderWrap:Y,handlerWrap:J},K=10,Q=200,C=15,O={width:"100%",height:"100%",maxWidth:"100%"};function ee({editor:e,node:t,updateAttributes:s}){const l=a.useRef(null),i=e.isActive(k.name),{data:h,width:f,height:m}=t.attrs,[o,w]=a.useState(null),[x,E]=a.useState(!0),[g,S]=a.useState(null),[j,T]=a.useState(100),v=a.useCallback(r=>()=>{T(u=>d.clamp(r==="minus"?u-C:u+C,K,Q))},[]);a.useEffect(()=>{let r=!1;return import("@excalidraw/excalidraw").then(u=>{r||(l.current=u.exportToSvg)}).catch(u=>!r&&S(u)).finally(()=>!r&&E(!1)),()=>{r=!0}},[h]),a.useEffect(()=>{let r=!1;return(async()=>{if(!l.current||r||x||g||!h)return;const b=await l.current(h);r||(b.setAttribute("width","100%"),b.setAttribute("height","100%"),b.setAttribute("display","block"),w(b))})(),()=>{r=!0}},[h,x,g]);const c=r=>{s({width:r.width,height:r.height})};return n.jsx(p.NodeViewWrapper,{className:p.clsx(A.wrap,i&&A.isActive),children:n.jsx(V.Resizable,{size:{width:Number.parseInt(f),height:Number.parseInt(m)},onResizeStop:(r,u,b,N)=>{c({width:Number.parseInt(f)+N.width,height:Number.parseInt(m)+N.height})},children:n.jsxs("div",{className:p.clsx(A.renderWrap,"render-wrapper"),style:{...O,overflow:"hidden"},children:[g&&n.jsx("div",{style:O,children:n.jsx("p",{children:g.message||g})}),x&&n.jsx("p",{children:"Loading..."}),!x&&!g&&o&&n.jsx("div",{dangerouslySetInnerHTML:{__html:(o==null?void 0:o.outerHTML)??""},style:{height:"100%",maxHeight:"100%",padding:24,overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",transform:`scale(${j/100})`,transition:"all ease-in-out .3s"}}),n.jsxs("div",{className:A.handlerWrap,children:[n.jsx(d.ActionButton,{action:v("minus"),icon:"ZoomOut",tooltip:"Zoom Out"}),n.jsx(d.ActionButton,{action:v("plus"),icon:"ZoomIn",tooltip:"Zoom In"})]})]})})})}const R={elements:[]},k=_.Node.create({name:"excalidraw",group:"block",selectable:!0,atom:!0,draggable:!0,inline:!1,addAttributes(){return{defaultShowPicker:{default:!1},createUser:{default:null},width:{default:"100%",parseHTML:p.getDatasetAttribute("width")},height:{default:240,parseHTML:p.getDatasetAttribute("height")},data:{default:R,parseHTML:p.getDatasetAttribute("data",!0)}}},addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),HTMLAttributes:{class:"excalidraw"},button:({editor:t})=>({component:F,componentProps:{editor:t}})}},parseHTML(){return[{tag:"div[class=excalidraw]"}]},renderHTML({HTMLAttributes:e,node:t}){return["div",_.mergeAttributes(this.options.HTMLAttributes,e,p.nodeAttrsToDataset(t))]},addCommands(){return{setExcalidraw:e=>({tr:t,commands:s,chain:l})=>{var i,h,f;return e=e||{},e.data=e.data||R,((f=(h=(i=t.selection)==null?void 0:i.node)==null?void 0:h.type)==null?void 0:f.name)==this.name?s.updateAttributes(this.name,e):l().insertContent({type:this.name,attrs:e}).run()}}},addNodeView(){return p.ReactNodeViewRenderer(ee)},addInputRules(){return[_.nodeInputRule({find:/^\$excalidraw\$$/,type:this.type,getAttributes:()=>({width:"100%"})})]}});exports.Excalidraw=k;exports.triggerOpenExcalidrawSettingModal=X;
